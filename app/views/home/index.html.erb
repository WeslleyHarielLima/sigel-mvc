<div class="sigel-dashboard-wrapper" style="padding: 2rem; background-color: #fcfcfc;">
  <!-- [HEADER] Mantendo seu h1 e a lógica de data original -->
  <header class="row align-items-center mb-5">
    <div class="col">
      <h1 class="mb-1" style="font-size: 2.25rem; font-weight: 850; color: #1a1a1a; letter-spacing: -1px;">
        Painel de Controle
      </h1>
      <p style="color: #666; font-size: 1rem;">Bem-vindo ao Sistema Integrado de Gestão de Leilões</p>
    </div>
    <div class="col-auto">
      <div class="d-flex align-items-center gap-3 p-3" style="background: #f0f4f2; border-radius: 16px; border: 1px solid #e0e6e3;">
        <iconify-icon icon="solar:calendar-bold-duotone" class="fs-2" style="color: #004d40;"></iconify-icon>
        <div>
          <div style="font-size: 0.7rem; color: #666; text-transform: uppercase; font-weight: 700;">Data Atual</div>
          <div style="font-size: 1rem; font-weight: 700; color: #004d40;"><%= l(Date.current, format: :long) %></div>
        </div>
      </div>
    </div>
  </header>
  <!-- [STATS CARDS] Mantendo sua lógica de @g_veiculos e joins -->
  <div class="row g-4 mb-5">
    <!-- Total -->
    <div class="col-md-3">
      <div class="stat-card-human">
        <div class="icon-box" style="background: #f0f0f0; color: #333;">
          <iconify-icon icon="solar:tram-broken"></iconify-icon>
        </div>
        <div class="value"><%= @g_veiculos&.count || 0 %></div>
        <div class="label">Total de Veículos</div>
      </div>
    </div>
    <!-- Disponíveis -->
    <div class="col-md-3">
      <div class="stat-card-human">
        <div class="icon-box" style="background: #d4edda; color: #28a745;">
          <iconify-icon icon="solar:check-circle-bold-duotone"></iconify-icon>
        </div>
        <div class="value"><%= (GVeiculo.joins(:g_status_veiculo).where(g_status_veiculos: { descricao: 'Disponível' }).count rescue 0) %></div>
        <div class="label">Disponíveis</div>
      </div>
    </div>
    <!-- Em Leilão -->
    <div class="col-md-3">
      <div class="stat-card-human">
        <div class="icon-box" style="background: #fff3cd; color: #856404;">
          <iconify-icon icon="solar:hand-money-bold-duotone"></iconify-icon>
        </div>
        <div class="value"><%= (GVeiculo.joins(:g_status_veiculo).where(g_status_veiculos: { descricao: 'Em Leilão' }).count rescue 0) %></div>
        <div class="label">Em Leilão</div>
      </div>
    </div>
    <!-- Aptos -->
    <div class="col-md-3">
      <div class="stat-card-human">
        <div class="icon-box" style="background: #e8f4ff; color: #007bff;">
          <iconify-icon icon="solar:shield-check-bold-duotone"></iconify-icon>
        </div>
        <div class="value"><%= (GVeiculo.where(apto: true).count rescue 0) %></div>
        <div class="label">Aptos p/ Leilão</div>
      </div>
    </div>
  </div>
  <!-- [QUICK ACTIONS] Lógica de links e ícones preservada -->
  <div class="row g-3 mb-5">
    <div class="col-lg-4">
      <%= link_to "#", class: "quick-action-card", style: "background: #fef9e7; border: 1px solid #f39c1230;" do %>
        <iconify-icon icon="solar:calendar-add-bold-duotone" style="color: #f39c12;"></iconify-icon>
        <div>
          <strong>Agendar Leilão</strong>
          <span>Criar novo evento de leilão</span>
        </div>
      <% end %>
    </div>
    <div class="col-lg-4">
      <%= link_to "#", class: "quick-action-card", style: "background: #e9f7f9; border: 1px solid #17a2b830;" do %>
        <iconify-icon icon="solar:document-add-bold-duotone" style="color: #17a2b8;"></iconify-icon>
        <div>
          <strong>Gerar Relatório</strong>
          <span>Exportar dados e estatísticas</span>
        </div>
      <% end %>
    </div>
    <div class="col-lg-4">
      <%= link_to root_path, class: "quick-action-card", style: "background: #fdeded; border: 1px solid #dc354530;" do %>
        <iconify-icon icon="solar:settings-bold-duotone" style="color: #dc3545;"></iconify-icon>
        <div>
          <strong>Configurações</strong>
          <span>Gerenciar tipos e categorias</span>
        </div>
      <% end %>
    </div>
  </div>
  <!-- [CHARTS & ACTIVITY] Aqui estava o erro: statuses definido antes do loop -->
  <div class="row">
    <div class="col-lg-8 mb-4">
      <div class="sigel-card-main">
        <div class="card-header-human">
          <h5><iconify-icon icon="solar:chart-2-bold-duotone"></iconify-icon> Distribuição por Status</h5>
        </div>
        <div class="card-body-human p-4">
          <div class="row g-4">
            <%# DEFINIÇÃO DA VARIÁVEL STATUSES MANTIDA IGUAL À SUA ORIGINAL %>
            <% statuses = {
              'Disponível'    => { label: 'Disponíveis', color: '#28a745', icon: 'solar:check-circle-bold' },
              'Em Leilão'     => { label: 'Em Leilão', color: '#ffc107', icon: 'solar:hand-money-bold' },
              'Vendido'       => { label: 'Vendidos', color: '#17a2b8', icon: 'solar:dollar-bold' },
              'Em Manutenção' => { label: 'Em Manutenção', color: '#dc3545', icon: 'solar:settings-bold' }
            } %>
            <% statuses.each do |status_db, config| %>
              <% count = (GVeiculo.joins(:g_status_veiculo).where(g_status_veiculos: { descricao: status_db }).count rescue 0) %>
              <% total = (GVeiculo.count rescue 0) %>
              <% percentage = total > 0 ? (count.to_f / total * 100).round : 0 %>
              <div class="col-md-3">
                <div class="status-indicator">
                  <div class="status-icon" style="color: <%= config[:color] %>">
                    <iconify-icon icon="<%= config[:icon] %>"></iconify-icon>
                  </div>
                  <div class="status-val"><%= count %></div>
                  <div class="status-lab"><%= config[:label] %></div>
                  <div class="status-progress-bg">
                    <div class="status-progress-bar" style="width: <%= percentage %>%; background: <%= config[:color] %>;"></div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <!-- Recent Vehicles -->
    <div class="col-lg-4 mb-4">
      <div class="sigel-card-main">
        <div class="card-header-human">
          <h5><iconify-icon icon="solar:clock-circle-bold-duotone"></iconify-icon> Cadastrados Recentemente</h5>
        </div>
        <div class="card-body-human p-0">
          <% recent_vehicles = GVeiculo.order(created_at: :desc).limit(5) %>
          <div class="table-responsive">
            <table class="table human-table mb-0">
              <thead>
                <tr>
                  <th>Placa</th>
                  <th>Veículo</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <% recent_vehicles.each do |veiculo| %>
                  <tr>
                    <td><span class="placa-badge"><%= veiculo.placa %></span></td>
                    <td>
                      <div class="veiculo-info">
                        <strong><%= veiculo.modelo %></strong>
                        <span><%= veiculo.g_marca_veiculo&.descricao %></span>
                      </div>
                    </td>
                    <td>
                      <%# LOGICA DE BADGE ORIGINAL MANTIDA %>
                      <% case veiculo.g_status_veiculo&.descricao %>
                      <% when 'Disponível' %>
                        <span class="status-dot" style="background: #28a745;" title="Disponível"></span>
                      <% when 'Em Leilão' %>
                        <span class="status-dot" style="background: #ffc107;" title="Em Leilão"></span>
                      <% when 'Vendido' %>
                        <span class="status-dot" style="background: #17a2b8;" title="Vendido"></span>
                      <% else %>
                        <span class="status-dot" style="background: #dc3545;" title="Manutenção"></span>
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<style>
  /* [ESTILOS HUMANOS - SEM ALTERAR LOGICA] */
  .stat-card-human {
    background: white;
    padding: 1.5rem;
    border-radius: 20px;
    border: 1px solid #eee;
    box-shadow: 0 2px 10px rgba(0,0,0,0.02);
  }
  .stat-card-human .icon-box {
    width: 45px;
    height: 45px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 1rem;
  }
  .stat-card-human .value {
    font-size: 2rem;
    font-weight: 800;
    color: #1a1a1a;
  }
  .stat-card-human .label {
    font-size: 0.9rem;
    color: #888;
    font-weight: 500;
  }

  .quick-action-card {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 1.25rem;
    border-radius: 16px;
    text-decoration: none !important;
    transition: transform 0.2s ease;
  }
  .quick-action-card:hover { transform: translateY(-3px); }
  .quick-action-card iconify-icon { font-size: 2.5rem; }
  .quick-action-card strong { display: block; color: #1a1a1a; font-size: 1.1rem; }
  .quick-action-card span { font-size: 0.85rem; color: #666; }

  .sigel-card-main { background: white; border-radius: 24px; border: 1px solid #eee; overflow: hidden; }
  .card-header-human { padding: 1.5rem; border-bottom: 1px solid #f5f5f5; }
  .card-header-human h5 { margin: 0; font-weight: 800; font-size: 1.1rem; display: flex; align-items: center; gap: 8px; }

  .status-indicator { text-align: center; }
  .status-val { font-size: 1.75rem; font-weight: 900; margin-bottom: 2px; }
  .status-lab { font-size: 0.75rem; font-weight: 700; color: #aaa; text-transform: uppercase; margin-bottom: 8px; }
  .status-progress-bg { height: 4px; background: #f0f0f0; border-radius: 10px; overflow: hidden; }
  .status-progress-bar { height: 100%; border-radius: 10px; }

  .human-table th { background: #fafafa; font-size: 0.75rem; text-transform: uppercase; color: #aaa; padding: 1rem; }
  .human-table td { padding: 1rem; vertical-align: middle; border-bottom: 1px solid #f9f9f9; }
  .placa-badge { background: #333; color: white; padding: 4px 8px; border-radius: 6px; font-family: monospace; font-size: 0.8rem; }
  .veiculo-info strong { display: block; font-size: 0.9rem; }
  .veiculo-info span { font-size: 0.75rem; color: #999; }
  .status-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; }
</style>