<div class="container-fluid fluxo-avaliacao">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1 fw-semibold">Central de Vistorias e Avalia√ß√£o</h2>
      <p class="text-muted mb-0">
        Monitoramento do fluxo operacional: Vistoria ‚Üí Checklist ‚Üí <strong>Avalia√ß√£o</strong>
      </p>
    </div>
  </div>
  <!-- Resumo / KPIs -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="sigel-kpi-card border-start border-4 border-warning">
        <div class="kpi-label">Aguardando Vistoria</div>
        <div class="kpi-value"><%= @aguardando_vistoria.size %></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="sigel-kpi-card border-start border-4 border-info">
        <div class="kpi-label">Em Checklist / Avalia√ß√£o</div>
        <div class="kpi-value"><%= @em_checklist.size %></div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="sigel-kpi-card border-start border-4 border-success">
        <div class="kpi-label">Avaliados</div>
        <div class="kpi-value"><%= @avaliados.size %></div>
      </div>
    </div>
  </div>
  <!-- Colunas -->
  <div class="row g-4">
    <!-- Aguardando Vistoria -->
    <div class="col-lg-4">
      <div class="card sigel-status-card">
        <div class="card-header sigel-header-warning">
          üü° Aguardando Vistoria
        </div>
        <div class="card-body">
          <% if @aguardando_vistoria.any? %>
            <% @aguardando_vistoria.each do |veiculo| %>
              <div class="sigel-item-card">
                <div>
                  <div class="fw-semibold"><%= veiculo.placa %></div>
                  <small class="text-muted"><%= veiculo.modelo %></small>
                </div>
                <div class="mt-2">
                  <%= link_to "Iniciar Vistoria",
                    new_g_vistoria_veiculo_path(g_veiculo_id: veiculo.id),
                    class: "btn btn-outline-warning btn-sm w-100" %>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="sigel-empty">
              Nenhum ve√≠culo aguardando vistoria no momento.
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <!-- Em Checklist -->
    <!-- Em Checklist -->
    <div class="col-lg-4">
      <div class="card sigel-status-card">
        <div class="card-header sigel-header-info">
          üîµ Em Checklist / Avalia√ß√£o
        </div>
        <div class="card-body">
          <% if @em_checklist.any? %>
            <% @em_checklist.each do |veiculo| %>
              <% vistoria = veiculo.g_vistorias_veiculos.order(created_at: :desc).first %>
              <div class="sigel-item-card">
                <div>
                  <div class="fw-semibold"><%= veiculo.placa %></div>
                  <small class="text-muted"><%= veiculo.modelo %></small>
                </div>
                <div class="mt-2">
                  <% if veiculo.vistoria_iniciada? && !veiculo.checklist_completo? && vistoria.present? %>
                    <span class="badge bg-secondary mb-2">Checklist em andamento</span>
                    <%= link_to "Preencher Checklist",
                            g_vistoria_veiculo_checklist_path(vistoria),
                            class: "btn btn-primary btn-sm w-100" %>
                  <% elsif veiculo.checklist_completo? && !veiculo.avaliado? %>
                    <span class="badge bg-success mb-2">Pronto para Avalia√ß√£o</span>
                    <%= link_to "Avaliar Ve√≠culo",
                            fluxo_avaliar_path(veiculo),
                            class: "btn btn-success btn-sm w-100" %>
                  <% else %>
                    <span class="badge bg-light text-muted">Aguardando pr√≥xima etapa</span>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="sigel-empty">
              Nenhum ve√≠culo em checklist ou avalia√ß√£o no momento.
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  <style>
    .sigel-status-card {
    border-radius: 10px;
    border: 1px solid #e5e7eb;
    }

    .sigel-header-warning {
    background: #f59f00;
    color: #1f2937;
    font-weight: 600;
    }

    .sigel-header-info {
    background: #3b82f6;
    color: #ffffff;
    font-weight: 600;
    }

    .sigel-header-success {
    background: #10b981;
    color: #ffffff;
    font-weight: 600;
    }

    .sigel-item-card {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    background: #ffffff;
    }

    .sigel-item-card:hover {
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    .sigel-empty {
    text-align: center;
    color: #6b7280;
    padding: 24px 12px;
    font-style: italic;
    }

    .sigel-kpi-card {
    background: #ffffff;
    border-radius: 10px;
    padding: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    .sigel-kpi-card .kpi-label {
    font-size: 0.85rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: .03em;
    }

    .sigel-kpi-card .kpi-value {
    font-size: 2rem;
    font-weight: 700;
    color: #111827;
    }
  </style>