<!-- Filtros -->
<div class="sigel-filtros">
  <div class="sigel-filtros-header">
    <iconify-icon icon="solar:filter-bold-duotone"></iconify-icon>
    <h5>Filtros de Pesquisa</h5>
  </div>
  <%= search_form_for @q, url: g_veiculos_path, method: :get do |f| %>
    <div class="row g-3">
      <!-- Placa -->
      <div class="col-md-3">
        <label class="sigel-form-label">
          <iconify-icon icon="solar:document-text-bold" class="me-1"></iconify-icon>
          Placa
        </label>
        <%= f.search_field :placa_cont, class: "form-control sigel-form-control", placeholder: "ABC-1234" %>
      </div>
      <!-- Status -->
      <div class="col-md-3">
        <label class="sigel-form-label">
          <iconify-icon icon="solar:tag-price-bold" class="me-1"></iconify-icon>
          Status
        </label>
        <%= f.select :status_eq, 
            options_for_select(GVeiculo::STATUSES.map { |k, v| [v, k] }, params.dig(:q, :status_eq)), 
            { include_blank: "Todos os Status" }, 
            class: "form-select sigel-form-select" %>
      </div>
      <!-- Tipo de Veículo -->
      <div class="col-md-3">
        <label class="sigel-form-label">
          <iconify-icon icon="solar:layers-bold" class="me-1"></iconify-icon>
          Tipo de Veículo
        </label>
        <%= f.select :g_tipo_veiculo_id_eq, 
            options_for_select(GTipoVeiculo.order(:descricao).pluck(:descricao, :id), params.dig(:q, :g_tipo_veiculo_id_eq)), 
            { include_blank: "Todos os Tipos" }, 
            class: "form-select sigel-form-select" %>
      </div>
      <!-- Apto para Leilão -->
      <div class="col-md-3">
        <label class="sigel-form-label">
          <iconify-icon icon="solar:shield-check-bold" class="me-1"></iconify-icon>
          Apto para Leilão
        </label>
        <%= f.select :apto_eq, 
            options_for_select([["Sim", true], ["Não", false]], params.dig(:q, :apto_eq)), 
            { include_blank: "Todos" }, 
            class: "form-select sigel-form-select" %>
      </div>
      <!-- Ações -->
      <div class="col-md-6 d-flex align-items-end gap-2">
        <%= f.submit "Aplicar Filtros", class: "btn btn-sigel-primary d-flex align-items-center gap-2" %>
        <%= link_to g_veiculos_path, class: "btn btn-sigel-outline d-flex align-items-center gap-2" do %>
          <iconify-icon icon="solar:restart-bold-duotone" class="fs-5"></iconify-icon>
          Limpar Filtros
        <% end %>
      </div>
    </div>
  <% end %>
</div>
<!-- Tabela de Veículos -->
<div class="sigel-card">
  <div class="sigel-card-header">
    <h5>
      <iconify-icon icon="solar:clipboard-list-bold-duotone"></iconify-icon>
      Lista de Veículos Cadastrados
    </h5>
    <span class="badge" style="background: var(--sigel-dourado); color: var(--sigel-verde-escuro); font-size: 0.9rem; padding: 0.5rem 1rem;">
      <%= @g_veiculos.total_count rescue @g_veiculos.count %> registros
    </span>
  </div>
  <div class="sigel-card-body p-0">
    <% if @g_veiculos.any? %>
      <div class="table-responsive">
        <table class="table sigel-table mb-0">
          <thead>
            <tr>
              <th>
                <iconify-icon icon="solar:document-text-bold" class="me-2"></iconify-icon>
                Placa
              </th>
              <th>
                <iconify-icon icon="solar:car-bold" class="me-2"></iconify-icon>
                Marca/Modelo
              </th>
              <th>
                <iconify-icon icon="solar:calendar-bold" class="me-2"></iconify-icon>
                Ano
              </th>
              <th>
                <iconify-icon icon="solar:layers-bold" class="me-2"></iconify-icon>
                Tipo
              </th>
              <th>
                <iconify-icon icon="solar:tag-price-bold" class="me-2"></iconify-icon>
                Status
              </th>
              <th class="text-center">
                <iconify-icon icon="solar:shield-check-bold" class="me-2"></iconify-icon>
                Apto
              </th>
              <th class="text-center">
                <iconify-icon icon="solar:settings-bold" class="me-2"></iconify-icon>
                Ações
              </th>
            </tr>
          </thead>
          <tbody>
            <% @g_veiculos.each do |veiculo| %>
              <tr>
                <td>
                  <div class="d-flex align-items-center gap-2">
                    <div style="width: 8px; height: 40px; background: var(--sigel-dourado); border-radius: 4px;"></div>
                    <strong style="font-family: 'JetBrains Mono', monospace; font-size: 1rem; color: var(--sigel-verde-escuro);">
                      <%= veiculo.placa %>
                    </strong>
                  </div>
                </td>
                <td>
                  <div>
                    <div style="font-weight: 600; color: var(--sigel-cinza-800);"><%= veiculo.marca %></div>
                    <div style="font-size: 0.85rem; color: var(--sigel-cinza-600);"><%= veiculo.modelo %></div>
                  </div>
                </td>
                <td><span style="font-weight: 600;"><%= veiculo.ano %></span></td>
                <td>
                  <span class="badge" style="background: var(--sigel-verde-claro); color: var(--sigel-verde-escuro); font-weight: 600;">
                    <%= veiculo.g_tipo_veiculo&.descricao %>
                  </span>
                </td>
                <td>
                  <% case veiculo.status %>
                  <% when 'disponivel' %>
                    <span class="sigel-badge sigel-badge-disponivel">
                      <iconify-icon icon="solar:check-circle-bold"></iconify-icon>
                      Disponível
                    </span>
                  <% when 'em_leilao' %>
                    <span class="sigel-badge sigel-badge-leilao">
                      <iconify-icon icon="solar:hand-money-bold"></iconify-icon>
                      Em Leilão
                    </span>
                  <% when 'vendido' %>
                    <span class="sigel-badge sigel-badge-vendido">
                      <iconify-icon icon="solar:dollar-bold"></iconify-icon>
                      Vendido
                    </span>
                  <% when 'em_manutencao' %>
                    <span class="sigel-badge sigel-badge-manutencao">
                      <iconify-icon icon="solar:settings-bold"></iconify-icon>
                      Manutenção
                    </span>
                  <% end %>
                </td>
                <td class="text-center">
                  <% if veiculo.apto? %>
                    <span class="sigel-badge sigel-badge-sucesso">
                      <iconify-icon icon="solar:check-circle-bold"></iconify-icon>
                      Sim
                    </span>
                  <% else %>
                    <span class="sigel-badge sigel-badge-erro">
                      <iconify-icon icon="solar:close-circle-bold"></iconify-icon>
                      Não
                    </span>
                  <% end %>
                </td>
                <td>
                  <div class="d-flex gap-2 justify-content-center">
                    <%= link_to g_veiculo_path(veiculo), class: "sigel-actions-btn sigel-actions-btn-visualizar" do %>
                      <iconify-icon icon="solar:eye-bold"></iconify-icon>
                    <% end %>
                    <%= link_to edit_g_veiculo_path(veiculo), class: "sigel-actions-btn sigel-actions-btn-editar" do %>
                      <iconify-icon icon="solar:pen-bold"></iconify-icon>
                    <% end %>
                    <%= button_to g_veiculo_path(veiculo),
                        method: :delete,
                        class: "sigel-actions-btn sigel-actions-btn-excluir",
                        data: { turbo_confirm: "Tem certeza que deseja excluir o veículo #{veiculo.placa}?" },
                        style: "border: none;" do %>
                      <iconify-icon icon="solar:trash-bin-trash-bold"></iconify-icon>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <!-- Paginação -->
      <div class="sigel-card-footer">
        <div class="d-flex justify-content-between align-items-center">
          <div class="text-muted">
            Exibindo <strong><%= @g_veiculos.size %></strong> de
            <strong><%= @g_veiculos.total_count rescue @g_veiculos.count %></strong> veículos
          </div>
          <div>
            <%== pagy_bootstrap_nav(@pagy) if defined?(@pagy) && @pagy.pages > 1 %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="p-5 text-center">
        <iconify-icon icon="solar:folder-open-bold-duotone" style="font-size: 5rem; color: var(--sigel-cinza-400);"></iconify-icon>
        <h5 class="mt-3" style="color: var(--sigel-cinza-600);">Nenhum veículo encontrado</h5>
        <p class="text-muted">Tente ajustar os filtros ou cadastre um novo veículo</p>
        <%= link_to new_g_veiculo_path, class: "btn btn-sigel-primary mt-3" do %>
          <iconify-icon icon="solar:add-circle-bold-duotone" class="me-2"></iconify-icon>
          Cadastrar Primeiro Veículo
        <% end %>
      </div>
    <% end %>
  </div>
</div>
